/**
 * Mapping of source id to color tables
 */
const ColorMaps = {
    4: [[0,0,0], [1,0,0], [3,0,0], [4,0,0], [6,0,0], [7,0,0], [9,0,0], [10,0,0], [12,0,0], [13,0,0], [15,0,0], [16,0,0], [18,0,0], [19,0,0], [21,0,0], [22,0,0], [24,0,0], [25,0,0], [27,0,0], [28,0,0], [30,0,0], [31,0,0], [32,0,0], [34,0,0], [36,0,0], [37,0,0], [39,0,0], [40,0,0], [42,0,0], [43,0,0], [44,0,0], [46,0,0], [48,0,0], [49,0,0], [51,0,0], [52,0,0], [54,0,0], [55,0,0], [56,0,0], [58,0,0], [60,0,0], [61,0,0], [63,0,0], [64,0,0], [65,0,0], [67,0,0], [69,0,0], [70,0,0], [72,0,0], [73,0,0], [75,0,0], [76,0,0], [78,0,0], [79,0,0], [81,0,0], [82,0,0], [84,0,0], [85,0,0], [87,0,0], [88,0,0], [89,0,0], [91,0,0], [93,0,0], [94,0,0], [96,0,0], [97,0,0], [98,0,0], [100,0,0], [102,0,0], [103,0,0], [105,0,0], [106,0,0], [108,0,0], [109,0,0], [110,0,0], [112,0,0], [113,0,0], [115,0,0], [117,0,0], [118,0,0], [120,0,0], [121,0,0], [122,0,0], [124,0,0], [126,0,0], [127,0,0], [129,0,0], [130,0,0], [131,0,0], [133,0,0], [134,0,0], [136,0,0], [138,0,0], [139,0,0], [141,0,0], [142,0,0], [144,0,0], [145,0,0], [147,0,0], [148,0,0], [150,0,0], [151,0,0], [153,0,0], [154,0,0], [156,0,0], [157,0,0], [159,0,0], [160,0,0], [162,0,0], [163,0,0], [165,0,0], [166,0,0], [168,0,0], [169,0,0], [171,0,0], [172,0,0], [174,0,0], [175,0,0], [177,0,0], [178,0,0], [179,0,0], [181,0,0], [182,0,0], [184,0,0], [186,0,0], [187,0,0], [189,0,0], [190,0,0], [192,0,0], [193,2,0], [195,4,0], [196,6,0], [197,8,0], [199,11,0], [201,13,0], [202,15,0], [204,16,0], [205,18,0], [207,20,0], [208,22,0], [210,25,0], [211,27,0], [213,29,0], [214,31,0], [216,32,0], [217,34,0], [219,36,0], [220,38,0], [221,40,0], [223,43,0], [225,45,0], [226,47,0], [227,48,0], [229,50,0], [230,52,0], [232,54,0], [234,57,0], [235,59,0], [237,61,0], [238,63,0], [240,65,0], [241,66,0], [243,68,0], [244,70,0], [245,72,0], [247,75,0], [249,77,0], [250,79,0], [252,81,0], [253,82,0], [255,84,0], [255,86,0], [255,89,0], [255,91,0], [255,93,0], [255,95,0], [255,97,0], [255,98,0], [255,100,0], [255,102,0], [255,104,0], [255,107,0], [255,109,0], [255,111,0], [255,113,0], [255,114,0], [255,116,0], [255,118,0], [255,121,0], [255,123,0], [255,125,0], [255,127,0], [255,129,2], [255,131,6], [255,132,10], [255,134,14], [255,136,18], [255,139,23], [255,141,27], [255,143,31], [255,145,34], [255,147,38], [255,148,42], [255,150,46], [255,153,51], [255,155,55], [255,157,59], [255,159,63], [255,161,66], [255,163,70], [255,164,74], [255,166,78], [255,168,82], [255,171,87], [255,173,91], [255,175,95], [255,177,98], [255,179,102], [255,180,106], [255,182,110], [255,185,115], [255,187,119], [255,189,123], [255,191,127], [255,193,131], [255,195,134], [255,196,138], [255,198,142], [255,200,146], [255,203,151], [255,205,155], [255,207,159], [255,209,163], [255,211,166], [255,212,170], [255,214,174], [255,217,179], [255,219,183], [255,221,187], [255,223,191], [255,225,195], [255,227,198], [255,228,202], [255,230,206], [255,232,210], [255,235,215], [255,237,219], [255,239,223], [255,241,227], [255,243,230], [255,244,234], [255,246,238], [255,249,243], [255,251,247], [255,253,251], [255,255,255]],
    5: [[0,0,0], [0,0,1], [1,1,2], [2,2,3], [3,3,4], [4,4,6], [5,5,7], [6,6,8], [7,6,9], [7,7,10], [8,8,12], [9,9,13], [10,10,14], [11,11,15], [12,12,17], [13,13,18], [14,13,19], [14,14,20], [15,15,21], [16,16,23], [17,17,24], [18,18,25], [19,19,26], [20,20,28], [21,20,29], [21,21,30], [22,22,31], [23,23,32], [24,24,34], [25,25,35], [26,26,36], [27,27,37], [28,27,38], [28,28,40], [29,29,41], [30,30,42], [31,31,43], [32,32,45], [33,33,46], [34,34,47], [35,34,48], [35,35,49], [36,36,51], [37,37,52], [38,38,53], [39,39,54], [40,40,56], [41,41,57], [42,41,58], [42,42,59], [43,43,60], [44,44,62], [45,45,63], [46,46,64], [47,47,65], [48,48,66], [49,48,68], [49,49,69], [50,50,70], [51,51,71], [52,52,73], [53,53,74], [54,54,75], [55,55,76], [56,55,77], [56,56,79], [57,57,80], [58,58,81], [59,59,82], [60,60,84], [61,61,85], [62,62,86], [63,62,87], [63,63,88], [64,64,90], [65,65,91], [66,66,92], [67,67,93], [68,68,94], [69,69,96], [70,69,97], [70,70,98], [71,71,99], [72,72,101], [73,73,102], [74,74,103], [75,75,104], [76,76,105], [77,76,107], [77,77,108], [78,78,109], [79,79,110], [80,80,112], [81,81,113], [82,82,114], [83,83,114], [84,84,115], [84,86,116], [85,87,117], [86,88,118], [87,89,119], [88,90,120], [89,92,121], [90,93,121], [91,94,122], [91,95,123], [92,96,124], [93,98,125], [94,99,126], [95,100,127], [96,101,128], [97,102,128], [98,104,129], [98,105,130], [99,106,131], [100,107,132], [101,109,133], [102,110,134], [103,111,135], [104,112,135], [105,113,136], [105,115,137], [106,116,138], [107,117,139], [108,118,140], [109,119,141], [110,121,142], [111,122,142], [112,123,143], [112,124,144], [113,125,145], [114,127,146], [115,128,147], [116,129,148], [117,130,149], [118,131,149], [119,133,150], [119,134,151], [120,135,152], [121,136,153], [122,137,154], [123,139,155], [124,140,156], [125,141,156], [126,142,157], [126,143,158], [127,145,159], [128,146,160], [129,147,161], [130,148,162], [131,149,163], [132,151,163], [133,152,164], [133,153,165], [134,154,166], [135,155,167], [136,157,168], [137,158,169], [138,159,170], [139,160,170], [140,161,171], [140,163,172], [141,164,173], [142,165,174], [143,166,175], [144,167,176], [145,169,177], [146,170,177], [147,171,178], [147,172,179], [148,173,180], [149,175,181], [150,176,182], [151,177,183], [152,178,184], [153,179,184], [154,181,185], [154,182,186], [155,183,187], [156,184,188], [157,186,189], [158,187,190], [159,188,191], [160,189,191], [161,190,192], [161,192,193], [162,193,194], [163,194,195], [164,195,196], [165,196,197], [166,198,198], [167,199,198], [168,199,199], [170,200,200], [171,201,201], [172,202,202], [174,203,203], [175,204,204], [177,205,205], [178,206,205], [179,206,206], [181,207,207], [182,208,208], [183,209,209], [185,210,210], [186,211,211], [188,212,212], [189,213,212], [190,213,213], [192,214,214], [193,215,215], [194,216,216], [196,217,217], [197,218,218], [198,219,219], [200,220,219], [201,220,220], [203,221,221], [204,222,222], [205,223,223], [207,224,224], [208,225,225], [209,226,226], [211,227,226], [212,227,227], [213,228,228], [215,229,229], [216,230,230], [218,231,231], [219,232,232], [220,233,233], [222,234,233], [223,234,234], [224,235,235], [226,236,236], [227,237,237], [229,238,238], [230,239,239], [231,240,240], [233,241,240], [234,241,241], [235,242,242], [237,243,243], [238,244,244], [239,245,245], [241,246,246], [242,247,247], [244,248,247], [245,248,248], [246,249,249], [248,250,250], [249,251,251], [250,252,252], [252,253,253], [253,254,254], [255,255,255]],
    10: [[0,0,0], [1,1,0], [2,2,0], [4,3,0], [5,4,0], [7,5,0], [8,6,0], [10,7,0], [11,8,0], [13,9,0], [14,10,0], [15,11,0], [17,12,0], [18,13,0], [20,14,0], [21,15,0], [23,16,0], [24,17,0], [26,18,0], [27,19,0], [28,20,0], [30,21,0], [31,22,0], [33,23,0], [34,24,0], [36,25,0], [37,26,0], [39,27,0], [40,28,0], [42,29,0], [43,30,0], [44,31,0], [46,32,0], [47,33,0], [49,34,0], [50,35,0], [52,36,0], [53,37,0], [55,38,0], [56,39,0], [57,40,0], [59,41,0], [60,42,0], [62,43,0], [63,44,0], [65,45,0], [66,46,0], [68,47,0], [69,48,0], [70,49,0], [72,50,0], [73,51,0], [75,52,0], [76,53,0], [78,54,0], [79,55,0], [81,56,0], [82,57,0], [84,58,0], [85,59,0], [86,60,0], [88,61,0], [89,62,0], [91,63,0], [92,64,0], [94,65,0], [95,66,0], [97,67,0], [98,68,0], [99,69,0], [101,70,0], [102,71,0], [104,72,0], [105,73,0], [107,74,0], [108,75,0], [110,76,0], [111,77,0], [113,78,0], [114,79,0], [115,80,0], [117,81,0], [118,82,0], [120,83,0], [121,84,0], [123,85,0], [124,86,0], [126,87,0], [127,88,0], [128,89,0], [130,90,0], [131,91,0], [133,92,0], [134,93,0], [136,94,0], [137,95,0], [139,96,0], [140,97,0], [141,98,0], [143,99,0], [144,100,0], [146,101,0], [147,102,0], [149,103,0], [150,104,0], [152,105,0], [153,106,0], [155,107,0], [156,108,0], [157,109,0], [159,110,0], [160,111,0], [162,112,0], [163,113,0], [165,114,0], [166,115,0], [168,116,0], [169,117,0], [170,118,0], [172,119,0], [173,120,0], [175,121,0], [176,122,0], [178,123,0], [179,124,0], [181,125,0], [182,126,0], [184,127,0], [185,128,0], [186,129,0], [188,130,0], [189,131,0], [191,132,0], [192,133,0], [194,134,0], [195,135,0], [197,136,0], [198,137,0], [199,138,0], [201,139,0], [202,140,0], [204,141,0], [205,142,0], [207,143,0], [208,144,0], [210,145,0], [211,146,0], [212,147,0], [214,148,0], [215,149,0], [217,150,0], [218,151,0], [220,152,0], [221,153,0], [223,154,0], [224,155,0], [226,156,0], [227,157,0], [228,158,0], [230,159,0], [231,160,0], [233,161,0], [234,162,0], [236,163,0], [237,164,0], [239,165,0], [240,166,0], [241,167,0], [243,168,0], [244,169,0], [246,170,0], [247,171,0], [249,172,0], [250,173,0], [252,174,0], [253,175,0], [255,176,0], [255,177,0], [255,178,0], [255,179,0], [255,180,0], [255,181,0], [255,182,0], [255,183,0], [255,184,0], [255,185,0], [255,186,0], [255,187,0], [255,188,0], [255,189,0], [255,190,0], [255,191,3], [255,192,7], [255,193,11], [255,194,15], [255,195,19], [255,196,23], [255,197,27], [255,198,31], [255,199,35], [255,200,39], [255,201,43], [255,202,47], [255,203,51], [255,204,54], [255,205,58], [255,206,62], [255,207,66], [255,208,70], [255,209,74], [255,210,78], [255,211,82], [255,212,86], [255,213,90], [255,214,94], [255,215,98], [255,216,102], [255,217,105], [255,218,109], [255,219,113], [255,220,117], [255,221,121], [255,222,125], [255,223,129], [255,224,133], [255,225,137], [255,226,141], [255,227,145], [255,228,149], [255,229,153], [255,230,156], [255,231,160], [255,232,164], [255,233,168], [255,234,172], [255,235,176], [255,236,180], [255,237,184], [255,238,188], [255,239,192], [255,240,196], [255,241,200], [255,242,204], [255,243,207], [255,244,211], [255,245,215], [255,246,219], [255,247,223], [255,248,227], [255,249,231], [255,250,235], [255,251,239], [255,252,243], [255,253,247], [255,254,251], [255,255,255]],
    13: [[0, 0, 0], [1, 0, 0], [2, 0, 0], [4, 0, 0], [5, 0, 0], [7, 0, 0], [8, 0, 0], [10, 0, 0], [11, 0, 0], [13, 0, 0], [14, 0, 0], [15, 0, 0], [17, 0, 0], [18, 0, 0], [20, 0, 0], [21, 0, 0], [23, 0, 0], [24, 0, 0], [26, 0, 0], [27, 0, 0], [28, 0, 0], [30, 0, 0], [31, 0, 0], [33, 0, 0], [34, 0, 0], [36, 0, 0], [37, 0, 0], [39, 0, 0], [40, 0, 0], [42, 0, 0], [43, 0, 0], [44, 0, 0], [46, 0, 0], [47, 0, 0], [49, 0, 0], [50, 0, 0], [52, 0, 0], [53, 0, 0], [55, 0, 0], [56, 0, 0], [57, 0, 0], [59, 0, 0], [60, 0, 0], [62, 0, 0], [63, 0, 0], [65, 0, 0], [66, 0, 0], [68, 0, 0], [69, 0, 0], [70, 0, 0], [72, 0, 0], [73, 0, 0], [75, 0, 0], [76, 0, 0], [78, 0, 0], [79, 0, 0], [81, 0, 0], [82, 0, 0], [84, 0, 0], [85, 0, 0], [86, 0, 0], [88, 0, 0], [89, 0, 0], [91, 0, 0], [92, 0, 0], [94, 0, 0], [95, 0, 0], [97, 0, 0], [98, 0, 0], [99, 0, 0], [101, 0, 0], [102, 0, 0], [104, 0, 0], [105, 0, 0], [107, 0, 0], [108, 0, 0], [110, 0, 0], [111, 0, 0], [113, 0, 0], [114, 0, 0], [115, 0, 0], [117, 0, 0], [118, 0, 0], [120, 0, 0], [121, 0, 0], [123, 0, 0], [124, 0, 0], [126, 0, 0], [127, 0, 0], [128, 0, 0], [130, 0, 0], [131, 0, 0], [133, 0, 0], [134, 0, 0], [136, 0, 0], [137, 0, 0], [139, 0, 0], [140, 0, 0], [141, 0, 0], [143, 0, 0], [144, 0, 0], [146, 0, 0], [147, 0, 0], [149, 0, 0], [150, 0, 0], [152, 0, 0], [153, 0, 0], [155, 0, 0], [156, 0, 0], [157, 0, 0], [159, 0, 0], [160, 0, 0], [162, 0, 0], [163, 0, 0], [165, 0, 0], [166, 0, 0], [168, 0, 0], [169, 0, 0], [170, 0, 0], [172, 0, 0], [173, 0, 0], [175, 1, 0], [176, 3, 0], [178, 5, 0], [179, 7, 0], [181, 9, 0], [182, 11, 0], [184, 13, 0], [185, 15, 0], [186, 17, 0], [188, 18, 0], [189, 20, 0], [191, 22, 0], [192, 24, 0], [194, 26, 0], [195, 28, 0], [197, 30, 0], [198, 32, 0], [199, 34, 0], [201, 35, 0], [202, 37, 0], [204, 39, 0], [205, 41, 0], [207, 43, 0], [208, 45, 0], [210, 47, 0], [211, 49, 0], [212, 51, 0], [214, 52, 0], [215, 54, 0], [217, 56, 0], [218, 58, 0], [220, 60, 0], [221, 62, 0], [223, 64, 0], [224, 66, 0], [226, 68, 0], [227, 69, 0], [228, 71, 0], [230, 73, 0], [231, 75, 0], [233, 77, 0], [234, 79, 0], [236, 81, 0], [237, 83, 0], [239, 85, 0], [240, 86, 0], [241, 88, 0], [243, 90, 0], [244, 92, 0], [246, 94, 0], [247, 96, 0], [249, 98, 0], [250, 100, 0], [252, 102, 0], [253, 103, 0], [255, 105, 0], [255, 107, 0], [255, 109, 0], [255, 111, 0], [255, 113, 0], [255, 115, 0], [255, 117, 0], [255, 119, 0], [255, 120, 0], [255, 122, 0], [255, 124, 0], [255, 126, 0], [255, 128, 0], [255, 130, 0], [255, 132, 0], [255, 134, 3], [255, 136, 7], [255, 137, 11], [255, 139, 15], [255, 141, 19], [255, 143, 23], [255, 145, 27], [255, 147, 31], [255, 149, 35], [255, 151, 39], [255, 153, 43], [255, 154, 47], [255, 156, 51], [255, 158, 54], [255, 160, 58], [255, 162, 62], [255, 164, 66], [255, 166, 70], [255, 168, 74], [255, 170, 78], [255, 171, 82], [255, 173, 86], [255, 175, 90], [255, 177, 94], [255, 179, 98], [255, 181, 102], [255, 183, 105], [255, 185, 109], [255, 187, 113], [255, 188, 117], [255, 190, 121], [255, 192, 125], [255, 194, 129], [255, 196, 133], [255, 198, 137], [255, 200, 141], [255, 202, 145], [255, 204, 149], [255, 205, 153], [255, 207, 156], [255, 209, 160], [255, 211, 164], [255, 213, 168], [255, 215, 172], [255, 217, 176], [255, 219, 180], [255, 221, 184], [255, 222, 188], [255, 224, 192], [255, 226, 196], [255, 228, 200], [255, 230, 204], [255, 232, 207], [255, 234, 211], [255, 236, 215], [255, 238, 219], [255, 239, 223], [255, 241, 227], [255, 243, 231], [255, 245, 235], [255, 247, 239], [255, 249, 243], [255, 251, 247], [255, 253, 251], [255, 255, 255]]
}

/** List of source IDs which should have the transparency filter applied */
const ApplyTransparency = [4, 5]

/**
 * Custom filter to make fully black pixels transparent.
 * This makes the occulter on LASCO images transparent.
 */
function TransparentBlackPixels(ctx, done) {
    let imgData = ctx.getImageData(
        0, 0, ctx.canvas.width, ctx.canvas.height);
    let pixels = imgData.data;
    let threshold = 2;
    for (var i = 0; i < pixels.length; i += 4) {
        if ((pixels[i] <= threshold) && (pixels[i+1] <= threshold) && (pixels[i+2] <= threshold)) {
            pixels[i + 3] = 0;
        }
    }
    ctx.putImageData(imgData, 0, 0);
    done();
}